/*!
 * papi
 * Page Type API with custom fields
 * http://github.com/
 * @author Fredrik Forsmo <fredrik.forsmo@gmail.com>
 * @version 2.3.0-dev
 * Copyright 2015. MIT licensed.
 */
!function(e){function t(a){if(n[a])return n[a].exports;var i=n[a]={exports:{},id:a,loaded:!1};return e[a].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}var i=n(1),r=a(i);r.init()},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(){u["default"].init(),o["default"].init(),d["default"].init(),s["default"].init(),v["default"].init(),y["default"].init(),b["default"].init(),w["default"].init(),_["default"].init(),x["default"].init(),O["default"].init(),j["default"].init(),T["default"].init(),D["default"].init(),S["default"].init(),$["default"].init()}Object.defineProperty(t,"__esModule",{value:!0}),t.init=i;var r=n(2),u=a(r),l=n(4),o=a(l),f=n(5),d=a(f),p=n(7),s=a(p),c=n(8),v=a(c),h=n(9),y=a(h),m=n(10),b=a(m),g=n(11),w=a(g),k=n(12),_=a(k),C=n(13),x=a(C),M=n(15),O=a(M),P=n(16),j=a(P),T=a(P),E=n(17),D=a(E),I=n(14),S=a(I),R=n(18),$=a(R)},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"](".papi-box-list > li > p").on("click",this.redirect),l["default"]('input[name="add-new-page-search"]').on("keyup",this.search),l["default"]("[data-papi-href]").on("click touchstart",this.redirect),l["default"](window).resize(this.setEqualBoxHeights),"select2"in l["default"].fn&&l["default"](".inside .papi-table tr .papi-component-select2").select2()}},{key:"addCurrentClassToMenuItem",value:function(){var e=l["default"](".wp-has-current-submenu .wp-submenu"),t=e.find('a[href*="papi-add-new-page"]').parent();t.hasClass("current")||e.find("li.current").length||t.addClass("current")}},{key:"redirect",value:function(e){e.preventDefault();var t=l["default"](this),n=t.data().papiHref;void 0!==n?window.location=n:window.location=l["default"](this).closest("[href]").attr("href")}},{key:"search",value:function(e){e.preventDefault();var t=l["default"](this),n=l["default"](".papi-box-list"),a=t.val();n.find(".papi-box-item").each(function(){var e=l["default"](this);e[-1===e.text().toLowerCase().indexOf(a)?"addClass":"removeClass"]("papi-hide")})}},{key:"setEqualBoxHeights",value:function(){var e=l["default"](".papi-box-item"),t=e.find(".papi-post-type-screenshot").length>0,n=0;t||(e=l["default"](".papi-post-type-info")),e.each(function(){var e=l["default"](this);t?e.find(".papi-post-type-info").removeAttr("style"):e.removeAttr("style");var a=e.height();n=a>n?a:n}),e.each(function(){var e=l["default"](this),a=n;if(t){var i=e.find(".papi-post-type-screenshot");i.length?a-=i.height():a+=5,e.find(".papi-post-type-info").height(a)}else e.height(a)})}},{key:"setSelectedMenuItem",value:function(){var e="string"==typeof window.location?window.location:window.location.href,t=l["default"]("#adminmenu");t.find("li.current > a.current").length||(e=e.substr(e.lastIndexOf("/")+1),e=e.replace(/\%2F/g,"/"),l["default"]('a[href="'+e+'"]',t).addClass("current").parent().addClass("current"))}}],[{key:"init",value:function(){var t=new e;t.binds(),t.setEqualBoxHeights(),t.setSelectedMenuItem(),t.addCurrentClassToMenuItem()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0===window.jQuery?{}:window.jQuery;t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"]("body").on("click",".papi-rq-link",this.requiredLink),l["default"]("#publish").on("click",this.publishPost)}},{key:"requiredLink",value:function(e){l["default"]("html, body").animate({scrollTop:l["default"]("[for="+l["default"](this).attr("href").replace("#","")+"]").offset().top-45})}},{key:"publishPost",value:function(e){for(var t=l["default"](this),n=l["default"](".papi-rq"),a=l["default"]("#publishing-action .spinner"),i=[],r=0,u=n.length;u>r;r++){var o=l["default"](n[r]);if(!o.parent().parent().hasClass("metabox-prefs")&&o.is(":visible")){var f=o.data(),d=l["default"]('[name="'+f.propertyId+'"]');d.length||(d=l["default"]('[name="'+f.propertyId+'[]"]').first()),void 0!==d.val()&&d.val().length||i.push(n[r])}}if(i.length){e.preventDefault(),a.hide(),t.removeClass("button-primary-disabled"),l["default"]("#message").remove();for(var p="",r=0,u=i.length;u>r;r++){var d=l["default"](i[r]),f=d.data();p+='<a class="papi-rq-link" href="#'+f.propertyId+'">'+f.propertyName+"</a>",r+1!==i.length&&(p+=", "),l["default"](".wrap h2").after('<div id="message" class="error below-h2"><p>'+window.papiL10n.requiredError+" "+p+"</p></div>")}}}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=n(6),f=a(o),d=function(){function e(){i(this,e)}return r(e,[{key:"bindRule",value:function(e,t){var n=this.getRuleSlug(e,t),a=this.getTarget(e),i=this.getSelector(n),r=this;l["default"]("body").on("keyup change",i,function(t){var i=l["default"]('[data-papi-rule-source-slug="'+e+'"]').text(),u={};if(i.length){var o=l["default"].parseJSON(i);for(var f in o){var d=o[f];"object"===l["default"].type(d)&&(u[f]=d,u[f].slug=n,null==u[f].source&&(u[f].source=r.getValue(d.slug)))}var p={rules:u,slug:e,$target:a};"change"===t.type?r.display(p):r.debounce(function(){r.display(p)},200)}})}},{key:"binds",value:function(){var e=this;l["default"]("body").on("init",'[data-papi-rules="true"]',function(){l["default"]('[data-papi-rules="true"]').each(function(){e.setupRules(l["default"](this))})}),l["default"]('[data-papi-rules="true"]').trigger("init")}},{key:"debounce",value:function(e,t,n){var a=void 0;!function(){var i=this,r=arguments,u=function(){a=null,n||e.apply(i,r)},l=n&&!a;clearTimeout(a),a=setTimeout(u,t),l&&e.apply(i,r)}()}},{key:"display",value:function(e){this.fetch(e,function(t){e.$target.closest(".papi-rules-exists")[t.render?"removeClass":"addClass"]("papi-hide")})}},{key:"fetch",value:function(e,t){var n={action:"get_rules_result",page_type:this.getPageTypeId(),post:l["default"]("#post_ID").val()},a={rules:e.rules,slug:e.$target.attr("name")};l["default"].ajax({type:"POST",data:{data:JSON.stringify(a)},dataType:"json",url:papi.ajaxUrl+"?"+l["default"].param(n)}).success(t)}},{key:"getPageTypeId",value:function(){var e=f["default"].getParameterByName("page_type");return e.length||(e=l["default"]('[data-papi-page-type-key="true"]').val()),e}},{key:"getRuleSlug",value:function(e,t){var n=/\[\d+\](\[\w+\])$/,a=/^papi\_/;return-1!==t.slug.indexOf(".")&&(t.slug=t.slug.split(".")[0]),n.test(e)&&(e=e.replace(n.exec(e)[1],"["+t.slug.replace(a,"")+"]"),l["default"]('[name="'+e+'"]').length&&(t.slug=e)),t.slug}},{key:"getSelector",value:function(e){return'[name="'+e+'[]"], [name="'+e+'"], [data-papi-rule="'+e+'"]'}},{key:"getTarget",value:function(e){var t=l["default"]('[name="'+e+'"]');return t.length||"]"===e.substr(-1)||(t=l["default"]('[name="'+e+'[]"]')),t.length||(t=l["default"]('[data-papi-rule="'+e+'"]'),t.attr("name",e)),t}},{key:"getValue",value:function(e){var t=this.getSelector(e),n=l["default"]('[name="'+e+'[]"]'),a=void 0;return n.length?a=[]:(n=l["default"](t).filter(function(){var e=l["default"](this);return"hidden"===e.attr("type")?!1:e.data("papi-rule-value")||""!==l["default"](this).val()}),n.length||(n=l["default"](t).filter(function(){var e=l["default"](this);return"hidden"===e.attr("type")||e.data("papi-rule-value")||""!==l["default"](this).val()}))),n.length?(n.each(function(){var e=l["default"](this);switch(e.attr("type")){case"checkbox":case"radio":if(!e.is(":checked"))return}if(null==a||a instanceof Array){var t=e.data("papi-rule-value");if(void 0!==t)a instanceof Array?a.push(t):a=t;else{var n=e.val();""!==n&&(a instanceof Array?a.push(n):a=n)}}}),a):void 0}},{key:"setupRules",value:function(e){var t=l["default"].parseJSON(e.text()),n=e.data("papi-rule-source-slug");for(var a in t){var i=t[a];"object"===l["default"].type(i)&&this.bindRule(n,i,t)}e.removeAttr("data-papi-rules")}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=d,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=window.wp,r=function(){function e(){n(this,e)}return a(e,null,[{key:"init",value:function(){(new e).binds()}},{key:"getParameterByName",value:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}},{key:"wpMediaEditor",value:function(t){return void 0!==e.wpMediaFrame&&e.wpMediaFrame.dispose(),e.wpMediaFrame=i.media(t).on("select",function(){for(var t=e.wpMediaFrame.state().get("selection").toJSON(),n=0,a=t.length;a>n;n++)null!==t[n]&&e.wpMediaFrame.trigger("insert",t[n])}),e.wpMediaFrame}},{key:"wpMediaFrame",get:function(){return this._wpMediaFrame},set:function(e){this._wpMediaFrame=e}}]),e}();t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"]("a[data-papi-tab]").on("click",this.changeTab)}},{key:"changeTab",value:function(e){e.preventDefault();var t=l["default"](this),n=t.data().papiTab;l["default"]("a[data-papi-tab]").parent().removeClass("active"),t.parent().addClass("active"),l["default"]("div[data-papi-tab]").removeClass("active").addClass("papi-hide"),l["default"]('div[data-papi-tab="'+n+'"]').addClass("active").removeClass("papi-hide")}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"](".papi-property-color-picker input").each(function(){var e=l["default"](this),t=e.data().palettes;e.wpColorPicker({color:!0,change:function(){e.trigger("change")},palettes:void 0===t?!1:t})})}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){this.pikaday(l["default"](".inside > .papi-table > tbody > tr > td > input.papi-property-datetime")),this.pikaday(l["default"](".papi-table .papi-table input.papi-property-datetime")),l["default"](document).on("papi/property/repeater/added",'[data-property="datetime"]',this.updateSelect)}},{key:"pikaday",value:function(e){void 0!==window.Pikaday&&e.length&&e.each(function(){var e=l["default"](this),t=e.data().settings;t.use24hour&&(t.format=t.format.replace(/hh/,"HH")),t.field=e[0],new window.Pikaday(t)})}},{key:"updateSelect",value:function(e){e.preventDefault(),this.pikaday(l["default"](this).prev())}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"](document).on("papi/property/repeater/added",'[data-property="dropdown"]',this.update)}},{key:"update",value:function(e){e.preventDefault();var t=l["default"](this).parent().find("select");t.hasClass("papi-component-select2")&&"select2"in l["default"].fn&&t.select2()}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){var e=this;l["default"](document).on("papi/property/repeater/added",'[data-property="editor"]',function(t){t.preventDefault(),e.update(l["default"](this))})}},{key:"createTinyMceEditor",value:function(e){var t=void 0;if(tinyMCEPreInit.mceInit[e])t=tinyMCEPreInit.mceInit[e];else{var n=void 0===tinyMCEPreInit.mceInit.content?tinyMCEPreInit.mceInit.papiHiddenEditor:tinyMCEPreInit.mceInit.content;t=tinyMCEPreInit.mceInit[e]=l["default"].extend({},n)}t=l["default"].extend(t,this.customTinyMCESettings,{selector:"#"+e,elements:e}),tinymce.init(t)}},{key:"closeAllQTags",value:function(e){void 0!==typeof QTags&&void 0!==e.canvas&&QTags.closeAllTags(e.id)}},{key:"getElements",value:function(e){return{$dom:tinyMCE.DOM,$iframe:l["default"]("#"+e.iframe)}}},{key:"getId",value:function(e){return e.replace("wp-","").replace("-wrap","")}},{key:"getSelectors",value:function(e){return{id:e,iframe:e+"_ifr",htmlTab:"#"+e+"-html",visualTab:"#"+e+"-tmce",wrap:"wp-"+e+"-wrap"}}},{key:"qtInit",value:function t(e){var n=void 0===tinyMCEPreInit.qtInit.content?tinyMCEPreInit.qtInit.papiHiddenEditor:tinyMCEPreInit.qtInit.content,t=tinyMCEPreInit.qtInit[e]=l["default"].extend({},n,{id:e,buttons:n.buttons.replace(",fullscreen","")});try{new QTags(t)}catch(a){}QTags._buttonsInit()}},{key:"update",value:function(e){var t=this.getId(e.parent().find("div[id]").attr("id"));if(void 0===tinyMCE.editors[t]){var n=this.getSelectors(t),a=this.getElements(n);this.closeAllQTags(a.$iframe),this.qtInit(n.id),this.createTinyMceEditor(t),l["default"](n.visualTab).removeAttr("onclick").on("click",function(e){e.preventDefault(),"function"==typeof window.switchEditors.switchto?window.switchEditors.switchto(this):window.switchEditors.go(t,"tmce")}),l["default"](n.htmlTab).removeAttr("onclick").on("click",function(e){e.preventDefault(),"function"==typeof window.switchEditors.switchto?window.switchEditors.switchto(this):window.switchEditors.go(t,"html")}),a.$dom.addClass(n.wrap,"tmce-active"),a.$dom.removeClass(n.wrap,"html-active")}}},{key:"customTinyMCESettings",get:function(){return{elements:[],mode:"exact",theme_advanced_resizing:!0}}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=n(6),f=a(o),d=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"](".inside .papi-table > tbody .papi-property-file.multiple .attachments").sortable({revert:!0});var e=this;l["default"](document).on("click",".papi-property-file .papi-file-select > .button",function(t){t.preventDefault(),e.add(l["default"](this))}),l["default"](document).on("mouseenter mouseleave",".papi-property-file .attachment",this.hover),l["default"](document).on("click",".papi-property-file .attachment a",this.remove),l["default"](document).on("change",".papi-property-repeater-top",this.update),l["default"](document).on("click",".papi-property-file .attachment",this.replace)}},{key:"add",value:function(e){var t=e.closest(".papi-property-file"),n=e.closest("p"),a=t.find(".attachments"),i=t.data("file-type"),r=t.hasClass("multiple"),u=e.data().slug,l=this,o={};"image"===i&&(o.type="image"),f["default"].wpMediaEditor({library:o,multiple:r}).on("insert",function(e){var t={alt:e.alt,id:e.id,slug:u,url:e.url};void 0!==e.sizes&&void 0!==e.sizes.thumbnail&&(t.url=e.sizes.thumbnail.url),"image"!==e.type&&(t.url=e.icon),"file"===i&&(t.filename=e.filename),l.render(a,t),r||n.addClass("papi-hide")}).open()}},{key:"hover",value:function(e){e.preventDefault(),l["default"](this).find("a").toggle()}},{key:"remove",value:function(e){e.stopPropagation(),e.preventDefault();var t=l["default"](this),n=t.closest(".papi-property-file");n.find(".papi-file-select").removeClass("papi-hide"),t.closest(".attachment").remove(),n.find("input[type=hidden]").trigger("change")}},{key:"render",value:function(e,t){var n=this.template;n=window._.template(l["default"].trim(n())),e.append('<div class="attachment">'+n(t)+"</div>"),e.find("input[type=hidden]").trigger("change")}},{key:"replace",value:function(e){e.preventDefault();var t=l["default"](this),n=t.closest(".papi-property-file"),a=t.find("img[src]"),i=t.find("input[type=hidden]"),r=i.val(),u={};"image"===n.data("file-type")&&(u.type="image"),f["default"].wpMediaEditor({library:u,multiple:!1}).on("open",function(){var e=f["default"].wpMediaFrame.state().get("selection"),t=window.wp.media.attachment(r);t.fetch(),e.add(t?[t]:[])}).on("insert",function(e){var r=e.url;void 0!==e.sizes&&void 0!==e.sizes.thumbnail&&(r=e.sizes.thumbnail.url),"image"!==e.type&&(r=e.icon),"file"===n.data("file-type")&&t.find(".filename div").text(e.filename),a.attr("src",r).attr("alt",e.alt),i.val(e.id),i.trigger("change")}).open()}},{key:"update",value:function(e){e.preventDefault(),l["default"](this).find("tr").last().find(".attachments").sortable({revert:!0})}},{key:"template",get:function(){return window.wp.template("papi-property-file")}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=function(e,t,n){for(var a=!0;a;){var i=e,r=t,u=n;l=f=o=void 0,a=!1,null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var o=l.get;return void 0===o?void 0:o.call(u)}var f=Object.getPrototypeOf(i);if(null===f)return void 0;e=f,t=r,n=u,a=!0}},o=n(3),f=a(o),d=n(14),p=a(d),s=function(e){function t(){i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return r(t,e),u(t,[{key:"add",value:function(e){var t=e.closest(".papi-property-repeater-top"),n=t.find(".repeater-tbody"),a=n.children().length,i=this.getJSON(e),r=e.data().layout,u=t.data().limit,l=void 0===u||-1===u||n.find("> tr").length<u;if(i.length&&l){var o=f["default"].parseJSON(i),d=this;this.fetch(o,a,r,function(e){d.addRow(n,a,e)})}}},{key:"binds",value:function(){var e=this;f["default"](".repeater-tbody").sortable({revert:!0,handle:".handle",helper:function(e,t){return t.children().each(function(){f["default"](this).width(f["default"](this).width())}),t},stop:function(){e.updateRowNumber(f["default"](this).closest(".repeater-tbody"))}}),f["default"](document).on("click",".papi-property-flexible .bottom button[type=button]",function(e){e.preventDefault(),f["default"](this).prev().removeClass("papi-hide")}),f["default"](document).on("click",".papi-property-flexible .flexible-layouts li a",function(t){t.preventDefault(),f["default"](this).closest(".flexible-layouts").addClass("papi-hide"),e.add(f["default"](this))}),f["default"](document).on("mouseup","body",function(e){var t=f["default"](".flexible-layouts:not(.papi-hide)");t.is(e.target)||0!==t.has(e.target).length||t.addClass("papi-hide")}),f["default"](document).on("click",".papi-property-flexible .repeater-remove-item",function(t){t.preventDefault(),e.remove(f["default"](this))})}},{key:"fetch",value:function(e,t,n,a){f["default"].ajax({type:"POST",data:{properties:JSON.stringify(e)},url:papi.ajaxUrl+"?action=get_properties&counter="+t+"&flexible_layout="+n,dataType:"json"}).success(a)}},{key:"remove",value:function(e){var t=e.closest(".papi-property-flexible").find(".repeater-tbody");e.closest("tr").remove(),this.updateRowNumber(t)}},{key:"updateDatabaseRowNumber",value:function(e){var t=e.find("tr tbody tr").length;e.closest(".papi-property-repeater-top").find(".papi-property-repeater-rows").val(e.find("tr tbody tr").length),this.triggerRule(e,t)}},{key:"template",get:function(){return window.wp.template("papi-property-flexible-row")}}],[{key:"init",value:function(){(new t).binds()}}]),t}(p["default"]);t["default"]=s,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"add",value:function(e){var t=e.closest(".papi-property-repeater-top"),n=t.find(".repeater-tbody"),a=n.children().length,i=this.getJSON(e),r=t.data().limit,u=void 0===r||-1===r||n.find("> tr").length<r;if(i.length&&u){var o=l["default"].parseJSON(i),f=this;this.fetch(o,a,function(e){f.addRow(n,a,e)})}}},{key:"addRow",value:function(e,t,n){for(var a=[],i=0,r=n.html.length;r>i;i++)"string"==typeof n.html[i]&&a.push(n.html[i]);var u=this.getHtml({columns:a.join(""),counter:t});u.appendTo(e),u.find('[name*="_property"]').trigger("papi/property/repeater/added"),u.find('[data-papi-rules="true"]').trigger("init"),this.scrollDownTable(e),this.updateDatabaseRowNumber(e),e.closest(".papi-property-repeater-top").trigger("change")}},{key:"binds",value:function(){var e=this;l["default"](".repeater-tbody").sortable({revert:!0,handle:".handle",helper:function(e,t){return t.children().each(function(){l["default"](this).width(l["default"](this).width())}),t},stop:function(){var t=l["default"](this).closest(".repeater-tbody");e.updateRowNumber(t)}}),l["default"](document).on("click",".papi-property-repeater .bottom button[type=button]",function(t){t.preventDefault(),e.add(l["default"](this))}),l["default"](document).on("click",".repeater-tbody span.toggle",function(t){t.preventDefault(),e.toggle(l["default"](this))}),l["default"](document).on("click",".papi-property-repeater .repeater-remove-item",function(t){t.preventDefault(),e.remove(l["default"](this))})}},{key:"fetch",value:function(e,t,n){l["default"].ajax({type:"POST",data:{properties:JSON.stringify(e)},url:papi.ajaxUrl+"?action=get_properties&counter="+t,dataType:"json"}).success(n)}},{key:"getJSON",value:function(e){return l["default"]('script[data-papi-json="'+e.data().papiJson+'"]').first().text()}},{key:"getHtml",value:function(e){var t=this.template;return t=window._.template(l["default"].trim(t())),l["default"](t(e))}},{key:"remove",value:function(e){var t=e.closest(".papi-property-repeater-top").find(".repeater-tbody");e.closest("tr").remove(),this.updateRowNumber(t)}},{key:"scrollDownTable",value:function(e){var t=l["default"]("> tr:last",e);l["default"]("html, body").animate({scrollTop:t.offset().top-t.height()})}},{key:"toggle",value:function(e){e.closest("tr").toggleClass("closed")}},{key:"triggerRule",value:function(e,t){var n=e.closest(".papi-property-repeater-top"),a=n.find(".bottom").next().attr("name").replace("[]","");l["default"]('[data-papi-rule="'+a+'"]').data("papi-rule-value",t).trigger("change")}},{key:"updateRowNumber",value:function(e){e.find("> tr").each(function(e,t){var n=l["default"](t);n.find("> td:first-child .count").text(e+1),n.find('[data-replace-slug="true"]').each(function(){var t=l["default"](this);t.attr("data-slug",t.attr("data-slug").replace(/(\[\d+\])/,"["+e+"]"))}),n.find('[name*="papi_"]').each(function(){var t=l["default"](this);t.attr("name",t.attr("name").replace(/(\[\d+\])/,"["+e+"]"))})}),this.updateDatabaseRowNumber(e)}},{key:"updateDatabaseRowNumber",value:function(e){var t=e.find("tr").length;e.closest(".papi-property-repeater-top").find(".papi-property-repeater-rows").val(),this.triggerRule(e,t)}},{key:"template",get:function(){return window.wp.template("papi-property-repeater-row")}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=n(6),f=(a(o),function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){var e=this;l["default"](document).on("click",'.papi-property-link button[data-link-action="add"]',function(t){t.preventDefault(),e.add(l["default"](this))}),l["default"](document).on("click","#wp-link-submit",function(t){void 0!==e.$el&&(t.preventDefault(),e.render(window.wpLink.getAttrs()))}),l["default"](document).on("click",'.papi-property-link button[data-link-action="edit"]',function(t){t.preventDefault(),e.edit(l["default"](this))}),l["default"](document).on("click",'.papi-property-link button[data-link-action="remove"]',function(t){t.preventDefault(),e.remove(l["default"](this))})}},{key:"add",value:function(e){this.$el=e.closest(".papi-property-link"),this.$p=this.$el.find("p"),this.oldLinkUpdate=window.wpLink.update,window.wpLink.update=function(){wpLink.close()},window.wpLink.open()}},{key:"edit",value:function(e){this.$el=e.closest(".papi-property-link"),this.$p=this.$el.find("p"),window.wpLink.open();var t=this.$el.find(".wp-link-url").val(),n=this.$el.find(".wp-link-text").val();l["default"]("#wp-link-url").val(l["default"].trim(t)),l["default"]("#wp-link-text").val(l["default"].trim(n)),"_blank"===l["default"].trim(this.$el.find(".wp-link-target").val())&&l["default"]("#wp-link-target").attr("checked","checked")}},{key:"remove",value:function(e){var t=e.closest(".papi-property-link");t.find(".link-table").remove();var n=t.find("p > span");n.first().removeClass("papi-hide"),n.last().addClass("papi-hide"),t.find("data-papi-rule").trigger("change")}},{key:"render",value:function(e){var t=this.template;t=window._.template(l["default"].trim(t())),e.link='<a href="'+e.href+'" target="_blank">'+e.href+"</a>",e.title=l["default"]("#wp-link-text").val(),e.slug=this.$el.data("slug"),this.$el.find(".link-table").remove(),this.$p.before(t(e));var n=this.$p.find("> span");n.first().addClass("papi-hide"),n.last().removeClass("papi-hide"),this.$el.find("data-papi-rule").trigger("change"),window.wpLink.update=this.oldLinkUpdate,this.wpLink=this.$el=this.$p=void 0}},{key:"template",get:function(){return window.wp.template("papi-property-link")}}],[{key:"init",value:function(){(new e).binds()}}]),e}());t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"binds",value:function(){l["default"](document).on("papi/property/repeater/added",'[data-property="post"]',this.update)}},{key:"update",value:function(e){e.preventDefault();var t=l["default"](this).parent().find("select");t.hasClass("papi-component-select2")&&"select2"in l["default"].fn&&t.select2()}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";
function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=function(){function e(){i(this,e)}return r(e,[{key:"add",value:function(e){var t=e.clone(),n=e.closest(".papi-property-relationship"),a=n.find(".relationship-right"),i=a.find("ul"),r=a.data().limit,u=void 0===r||-1===r||i.find("li").length<r;u&&(t.find("span.icon").removeClass("plus").addClass("minus"),t.find("input").attr("name",t.find("input").data().name),t.appendTo(i),this.triggerRule(n))}},{key:"binds",value:function(){var e=this;l["default"](".relationship-right > ul").sortable({placeholder:"ui-state-highlight",start:function(e,t){t.item.addClass("sortable")},stop:function(e,t){t.item.removeClass("sortable")}}).disableSelection(),l["default"](document).on("click",".papi-property-relationship .relationship-left li",function(t){t.preventDefault(),e.add(l["default"](this))}),l["default"](document).on("click",".papi-property-relationship .relationship-right li",function(t){t.preventDefault(),e.remove(l["default"](this))}),l["default"](document).on("keyup",".papi-property-relationship input[type=search]",this.search),l["default"](document).on("papi/property/repeater/added",'[data-property="relationship"]',this.update)}},{key:"remove",value:function(e){var t=e.closest(".papi-property-relationship");e.remove(),this.triggerRule(t)}},{key:"search",value:function(e){e.preventDefault();var t=l["default"](this),n=t.closest(".papi-property-relationship").find(".relationshio-left ul"),a=t.val().toLowerCase();n.find("li").each(function(){var e=l["default"](this);-1===e.text().toLowerCase().indexOf(a)?e.addClass("papi-hide"):e.removeClass("papi-hide")})}},{key:"triggerRule",value:function(e){e.find("[data-papi-rule]").trigger("change")}},{key:"update",value:function(e){e.preventDefault();var t=l["default"](this),n=t.prev();n.find(".relationship-left [name]").each(function(){t=l["default"](this),t.data("name",t.attr("name")),t.removeAttr("name")})}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(3),l=a(u),o=n(6),f=a(o),d=function(){function e(){i(this,e)}return r(e,[{key:"add",value:function(e){e.preventDefault();var t=l["default"](this);f["default"].wpMediaEditor().on("insert",function(e){t.prev().val(e.url)}).open()}},{key:"binds",value:function(){l["default"](document).on("click",".papi-url-media-button",this.add)}}],[{key:"init",value:function(){(new e).binds()}}]),e}();t["default"]=d,e.exports=t["default"]}]);